/*! 
 Build based on gin-vue-admin 
 Time : 1670837959000 */
import{g as e,d as a,f as l,a as t,c as s,u as i}from"./appUploadImg.122bd123.js";import{f as o,a as u,g as r}from"./format.215352f7.js";import{r as d,j as n,G as p,u as c,a as v,b as m,o as g,c as f,d as y,e as b,w as h,h as w,t as I,A as _,F as k,x as C,m as z,H as x,i as U,C as j}from"./index.42b7f490.js";import"./date.34b11046.js";import"./dictionary.528e6e48.js";import"./dictionary.3462a5b2.js";import"./sysDictionary.e268ed4c.js";const T={class:"gva-search-box"},V={class:"gva-table-box"},q={class:"gva-btn-list"},A=y("p",null,"确定要删除吗？",-1),D={style:{"text-align":"right","margin-top":"8px"}},F={class:"gva-pagination"},S={class:"dialog-footer"},B={name:"AppUploadImg"},R=Object.assign(B,{setup(B){const R=d("/api"),$=n(),G=d(""),H=p(),K=c();console.log("获取的参数",H.query.id),K.isReady().then((()=>{N.value.custInfoId=H.query.id}));const O=d(!1),E=e=>{O.value=!0;const a="image/jpeg"===e.type,l="image/png"===e.type,t=e.size/1024/1024<.5;return a||l||(U.error("上传图片只能是 jpg或png 格式!"),O.value=!1),t||(U.error("未压缩未见上传图片大小不能超过 500KB，请使用压缩上传"),O.value=!1),(l||a)&&t},J=e=>{if(O.value=!1,console.log("图片",e),0===e.code){var a=e.data.file.url;G.value="/api/"+a,console.log("图片地址",G.value),N.value.imgUrl=a,U({type:"success",message:"上传成功"}),0===e.code&&ie()}else U({type:"warning",message:e.msg})},L=()=>{U({type:"error",message:"上传失败"}),O.value=!1};d(null);const M=d([]),N=d({custInfoId:H.query.id,reqId:"",picType:void 0,imgUrl:"",sysFlowId:""}),P=v({picType:[{required:!0,message:"",trigger:["input","blur"]}],imgUrl:[{required:!0,message:"",trigger:["input","blur"]}]}),Q=d(),W=d(1),X=d(0),Y=d(10),Z=d([]),ee=d({}),ae=()=>{ee.value={}},le=()=>{W.value=1,Y.value=10,ie()},te=e=>{Y.value=e,ie()},se=e=>{W.value=e,ie()},ie=async()=>{ee.value.custInfoId=H.query.id;const a=await e({page:W.value,pageSize:Y.value,...ee.value});0===a.code&&(Z.value=a.data.list,X.value=a.data.total,W.value=a.data.page,Y.value=a.data.pageSize)};ie();(async()=>{M.value=await r("uploadImgType")})();const oe=d([]),ue=e=>{oe.value=e},re=d(!1),de=async()=>{const e=[];if(0===oe.value.length)return void U({type:"warning",message:"请选择要删除的数据"});oe.value&&oe.value.map((a=>{e.push(a.ID)}));0===(await a({ids:e})).code&&(U({type:"success",message:"删除成功"}),Z.value.length===e.length&&W.value>1&&W.value--,re.value=!1,ie())},ne=d(""),pe=async e=>{0===(await t({ID:e.ID})).code&&(U({type:"success",message:"删除成功"}),1===Z.value.length&&W.value>1&&W.value--,ie())},ce=d(!1),ve=()=>{ne.value="create",ce.value=!0},me=()=>{ce.value=!1,N.value={custInfoId:H.query.id,reqId:"",picType:void 0,imgUrl:"",sysFlowId:""}},ge=async()=>{var e;null==(e=Q.value)||e.validate((async e=>{if(!e)return;let a;switch(N.value.custInfoId=parseInt(N.value.custInfoId),console.log("接收的参数",H.query.id),ne.value){case"create":default:a=await s(N.value);break;case"update":a=await i(N.value)}0===a.code&&(U({type:"success",message:"创建/更改成功"}),me(),ie())}))};return(e,a)=>{const t=m("el-date-picker"),s=m("el-form-item"),i=m("el-button"),r=m("el-form"),d=m("el-popover"),n=m("el-table-column"),p=m("el-image"),c=m("el-table"),v=m("el-pagination"),U=m("el-option"),B=m("el-select"),H=m("el-upload"),K=m("el-dialog");return g(),f("div",null,[y("div",T,[b(r,{inline:!0,model:ee.value,class:"demo-form-inline"},{default:h((()=>[b(s,{label:"创建时间"},{default:h((()=>[b(t,{modelValue:ee.value.startCreatedAt,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.startCreatedAt=e),type:"datetime",placeholder:"开始时间"},null,8,["modelValue"]),w(" — "),b(t,{modelValue:ee.value.endCreatedAt,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value.endCreatedAt=e),type:"datetime",placeholder:"结束时间"},null,8,["modelValue"])])),_:1}),b(s,null,{default:h((()=>[b(i,{size:"small",type:"primary",icon:"search",onClick:le},{default:h((()=>[w("查询")])),_:1}),b(i,{size:"small",icon:"refresh",onClick:ae},{default:h((()=>[w("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),y("div",V,[y("div",q,[b(i,{size:"small",type:"primary",icon:"plus",onClick:ve},{default:h((()=>[w("新增")])),_:1}),b(d,{visible:re.value,"onUpdate:visible":a[4]||(a[4]=e=>re.value=e),placement:"top",width:"160"},{reference:h((()=>[b(i,{icon:"delete",size:"small",style:{"margin-left":"10px"},disabled:!oe.value.length,onClick:a[3]||(a[3]=e=>re.value=!0)},{default:h((()=>[w("删除")])),_:1},8,["disabled"])])),default:h((()=>[A,y("div",D,[b(i,{size:"small",type:"primary",link:"",onClick:a[2]||(a[2]=e=>re.value=!1)},{default:h((()=>[w("取消")])),_:1}),b(i,{size:"small",type:"primary",onClick:de},{default:h((()=>[w("确定")])),_:1})])])),_:1},8,["visible"])]),b(c,{ref:"multipleTable",style:{width:"100%"},"tooltip-effect":"dark",data:Z.value,"row-key":"ID",onSelectionChange:ue},{default:h((()=>[b(n,{align:"left",label:"日期",width:"180"},{default:h((e=>[w(I(_(o)(e.row.CreatedAt)),1)])),_:1}),b(n,{align:"left",label:"商户进件编号",prop:"custInfoId",width:"150"}),b(n,{align:"left",label:"流水号",prop:"reqId",width:"150"}),b(n,{align:"left",label:"图片类别",prop:"picType",width:"120"},{default:h((e=>[w(I(_(u)(e.row.picType,M.value)),1)])),_:1}),b(n,{align:"left",label:"图片地址",prop:"imgUrl",width:"150"},{default:h((e=>[b(p,{style:{width:"100px",height:"100px"},src:"https://jiyunbao.vvv5g.com/api/"+e.row.imgUrl,fit:"cover"},null,8,["src"])])),_:1}),b(n,{align:"left",label:"入网申请流水号",prop:"sysFlowId",width:"120"}),b(n,{align:"left",label:"按钮组"},{default:h((e=>[b(i,{type:"primary",link:"",icon:"edit",size:"small",class:"table-button",onClick:a=>(async e=>{const a=await l({ID:e.ID});ne.value="update",0===a.code&&(N.value=a.data.reappUploadImg,console.log("数据详情",a.data),G.value="/api/"+a.data.reappUploadImg.imgUrl,ce.value=!0)})(e.row)},{default:h((()=>[w("变更图片")])),_:2},1032,["onClick"]),b(i,{type:"primary",link:"",icon:"delete",size:"small",onClick:a=>{return l=e.row,void j.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{pe(l)}));var l}},{default:h((()=>[w("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),y("div",F,[b(v,{layout:"total, sizes, prev, pager, next, jumper","current-page":W.value,"page-size":Y.value,"page-sizes":[10,30,50,100],total:X.value,onCurrentChange:se,onSizeChange:te},null,8,["current-page","page-size","total"])])]),b(K,{modelValue:ce.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ce.value=e),"before-close":me,title:"弹窗操作"},{footer:h((()=>[y("div",S,[b(i,{size:"small",onClick:me},{default:h((()=>[w("取 消")])),_:1}),b(i,{size:"small",type:"primary",onClick:ge},{default:h((()=>[w("确 定")])),_:1})])])),default:h((()=>[b(r,{model:N.value,"label-position":"right",ref_key:"elFormRef",ref:Q,rules:P,"label-width":"120px"},{default:h((()=>[b(s,{label:"图片类别:",prop:"picType"},{default:h((()=>[b(B,{modelValue:N.value.picType,"onUpdate:modelValue":a[5]||(a[5]=e=>N.value.picType=e),placeholder:"请选择",style:{width:"100%"},clearable:!0},{default:h((()=>[(g(!0),f(k,null,C(M.value,((e,a)=>(g(),z(U,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(s,{label:"图片:"},{default:h((()=>[y("div",{class:"user-headpic-update",style:x({"background-image":`url(${G.value})`,"background-repeat":"no-repeat","background-size":"cover",width:"200px",height:"200px"})},null,4),b(H,{action:`${R.value}/fileUploadAndDownload/upload`,"before-upload":E,headers:{"x-token":_($).token},"on-error":L,"on-success":J,"show-file-list":!1,class:"upload-btn"},{default:h((()=>[b(i,{size:"small",type:"primary"},{default:h((()=>[w("上传图片")])),_:1})])),_:1},8,["action","headers"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}});export{R as default};

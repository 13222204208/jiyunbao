/*! 
 Build based on gin-vue-admin 
 Time : 1677739392000 */
import{g as a,d as e,c as t,u as l,a as u}from"./authority.00e5bdda.js";import r from"./menus.d48dda99.js";import o from"./apis.a46441f0.js";import i from"./datas.570001a8.js";import{W as d}from"./warningBar.924d2bfe.js";import{r as s,b as n,o as y,c as h,e as m,d as v,w as c,h as p,m as f,f as I,A as b,i as g}from"./index.533d8bbb.js";import"./authorityBtn.d21f74bc.js";import"./api.cc9aa125.js";const w={class:"authority"},k={class:"gva-table-box"},_={class:"gva-btn-list"},C={class:"dialog-footer"},N={name:"Authority"},V=Object.assign(N,{setup(N){const V=s([{authorityId:0,authorityName:"根角色"}]),z=s(!1),j=s("add"),x=s({}),A=s("新增角色"),U=s(!1),B=s(!1),S=s({}),q=s({authorityId:0,authorityName:"",parentId:0}),D=s({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),R=s(1),E=s(0),F=s(999),T=s([]),O=s({}),P=async()=>{const e=await a({page:R.value,pageSize:F.value,...O.value});0===e.code&&(T.value=e.data.list,E.value=e.data.total,R.value=e.data.page,F.value=e.data.pageSize)};P();const W=(a,e)=>{x.value[a]=e},$=s(null),G=s(null),H=s(null),J=(a,e)=>{const t=[$,G,H];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},K=s(null),L=()=>{K.value&&K.value.resetFields(),q.value={authorityId:0,authorityName:"",parentId:0}},M=()=>{L(),U.value=!1,B.value=!1},Q=()=>{if(q.value.authorityId=Number(q.value.authorityId),0===q.value.authorityId)return g({type:"error",message:"角色id不能为0"}),!1;K.value.validate((async a=>{if(a){switch(j.value){case"add":0===(await u(q.value)).code&&(g({type:"success",message:"添加成功!"}),P(),M());break;case"edit":0===(await l(q.value)).code&&(g({type:"success",message:"添加成功!"}),P(),M());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=q.value.authorityId,a.authority.authorityName=q.value.authorityName,a.authority.parentId=q.value.parentId,a.authority.dataAuthorityId=S.value.dataAuthorityId,a.oldAuthorityId=S.value.authorityId;0===(await t(a)).code&&(g({type:"success",message:"复制成功！"}),P())}}L(),U.value=!1}}))},X=()=>{V.value=[{authorityId:0,authorityName:"根角色"}],Y(T.value,V.value,!1)},Y=(a,e,t)=>{q.value.authorityId=String(q.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===q.value.authorityId,children:[]};Y(a.children,l.children,t||a.authorityId===q.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===q.value.authorityId};e.push(l)}}))},Z=a=>{L(),A.value="新增角色",j.value="add",q.value.parentId=a,X(),U.value=!0};return(a,t)=>{const l=n("el-button"),u=n("el-table-column"),s=n("el-table"),N=n("el-cascader"),B=n("el-form-item"),E=n("el-input"),F=n("el-form"),O=n("el-dialog"),L=n("el-tab-pane"),Y=n("el-tabs"),aa=n("el-drawer");return y(),h("div",w,[m(d,{title:"注：右上角头像下拉可切换角色"}),v("div",k,[v("div",_,[m(l,{size:"small",type:"primary",icon:"plus",onClick:t[0]||(t[0]=a=>Z(0))},{default:c((()=>[p("新增角色")])),_:1})]),m(s,{data:T.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:c((()=>[m(u,{label:"角色ID","min-width":"180",prop:"authorityId"}),m(u,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),m(u,{align:"left",label:"操作",width:"460"},{default:c((a=>[m(l,{icon:"setting",size:"small",type:"primary",link:"",onClick:e=>{return t=a.row,z.value=!0,void(x.value=t);var t}},{default:c((()=>[p("设置权限")])),_:2},1032,["onClick"]),m(l,{icon:"plus",size:"small",type:"primary",link:"",onClick:e=>Z(a.row.authorityId)},{default:c((()=>[p("新增子角色")])),_:2},1032,["onClick"]),m(l,{icon:"copy-document",size:"small",type:"primary",link:"",onClick:e=>(a=>{X(),A.value="拷贝角色",j.value="copy";for(const e in q.value)q.value[e]=a[e];S.value=a,U.value=!0})(a.row)},{default:c((()=>[p("拷贝")])),_:2},1032,["onClick"]),m(l,{icon:"edit",size:"small",type:"primary",link:"",onClick:e=>(a=>{X(),A.value="编辑角色",j.value="edit";for(const e in q.value)q.value[e]=a[e];X(),U.value=!0})(a.row)},{default:c((()=>[p("编辑")])),_:2},1032,["onClick"]),m(l,{icon:"delete",size:"small",type:"primary",link:"",onClick:t=>{return l=a.row,void b.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await e({authorityId:l.authorityId})).code&&(g({type:"success",message:"删除成功!"}),1===T.value.length&&R.value>1&&R.value--,P())})).catch((()=>{g({type:"info",message:"已取消删除"})}));var l}},{default:c((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),m(O,{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=a=>U.value=a),title:A.value},{footer:c((()=>[v("div",C,[m(l,{size:"small",onClick:M},{default:c((()=>[p("取 消")])),_:1}),m(l,{size:"small",type:"primary",onClick:Q},{default:c((()=>[p("确 定")])),_:1})])])),default:c((()=>[m(F,{ref_key:"authorityForm",ref:K,model:q.value,rules:D.value,"label-width":"80px"},{default:c((()=>[m(B,{label:"父级角色",prop:"parentId"},{default:c((()=>[m(N,{modelValue:q.value.parentId,"onUpdate:modelValue":t[1]||(t[1]=a=>q.value.parentId=a),style:{width:"100%"},disabled:"add"==j.value,options:V.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),m(B,{label:"角色ID",prop:"authorityId"},{default:c((()=>[m(E,{modelValue:q.value.authorityId,"onUpdate:modelValue":t[2]||(t[2]=a=>q.value.authorityId=a),disabled:"edit"==j.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),m(B,{label:"角色姓名",prop:"authorityName"},{default:c((()=>[m(E,{modelValue:q.value.authorityName,"onUpdate:modelValue":t[3]||(t[3]=a=>q.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),z.value?(y(),f(aa,{key:0,modelValue:z.value,"onUpdate:modelValue":t[5]||(t[5]=a=>z.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:c((()=>[m(Y,{"before-leave":J,type:"border-card"},{default:c((()=>[m(L,{label:"角色菜单"},{default:c((()=>[m(r,{ref_key:"menus",ref:$,row:x.value,onChangeRow:W},null,8,["row"])])),_:1}),m(L,{label:"角色api"},{default:c((()=>[m(o,{ref_key:"apis",ref:G,row:x.value,onChangeRow:W},null,8,["row"])])),_:1}),m(L,{label:"资源权限"},{default:c((()=>[m(i,{ref_key:"datas",ref:H,authority:T.value,row:x.value,onChangeRow:W},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):I("",!0)])}}});export{V as default};

/*! 
 Build based on gin-vue-admin 
 Time : 1675228064000 */
import e from"./fieldDialog.0b6f1f0e.js";import a from"./previewCodeDialg.cfe6c1dc.js";import{a as l,b as t,t as i,c as d}from"./stringFun.1a90c7e7.js";import{p as o,c as u,g as s,a as r,b as n,d as m,e as p}from"./autoCode.dd30adfb.js";import{g as c}from"./dictionary.48efcc1b.js";import{_ as v,C as f,u as b,a as g,r as y,J as N,b as _,o as k,c as h,e as V,d as w,w as x,h as C,F as T,x as U,m as z,t as D,f as S,i as F,q,v as B,al as j}from"./index.6ee4fc76.js";import{W as L}from"./warningBar.05f9d88c.js";import"./sysDictionary.43866835.js";import"./dictionary.48a09a1f.js";const J=e=>(q("data-v-ed11d2a0"),e=e(),B(),e),A={class:"gva-search-box"},O={style:{fontSize:"16px",paddingLeft:"20px"}},R={class:"gva-search-box"},E={style:{float:"right",color:"#8492a6","font-size":"13px"}},M=J((()=>w("div",null," 自动创建API ",-1))),P=J((()=>w("div",null," 自动移动文件 ",-1))),$={class:"gva-table-box"},I={class:"gva-btn-list"},X=J((()=>w("p",null,"确定删除吗？",-1))),G={style:{"text-align":"right","margin-top":"8px"}},Q={class:"gva-btn-list justify-content-flex-end auto-btn-list"},W={class:"dialog-footer"},H={class:"previewCodeTool"},K=J((()=>w("p",null,"操作栏：",-1))),Y={class:"dialog-footer",style:{"padding-top":"14px","padding-right":"14px"}},Z={name:"AutoCode"},ee=v(Object.assign(Z,{setup(v){const q={fieldName:"",fieldDesc:"",fieldType:"",dataType:"",fieldJson:"",columnName:"",dataTypeLong:"",comment:"",require:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""},B=f(),J=b(),Z=g([]),ee=y({}),ae=y({dbName:"",tableName:""}),le=y([]),te=y(""),ie=y({}),de=y({structName:"",tableName:"",packageName:"",package:"",abbreviation:"",description:"",businessDB:"",autoCreateApiToSql:!0,autoMoveFile:!0,autoCreateResource:!1,fields:[]}),oe=y({structName:[{required:!0,message:"请输入结构体名称",trigger:"blur"}],abbreviation:[{required:!0,message:"请输入结构体简称",trigger:"blur"}],description:[{required:!0,message:"请输入结构体描述",trigger:"blur"}],packageName:[{required:!0,message:"文件名称：sysXxxxXxxx",trigger:"blur"}],package:[{required:!0,message:"请选择package",trigger:"blur"}]}),ue=y({}),se=y({}),re=y(!1),ne=y(!1),me=y(null),pe=()=>{me.value.selectText()},ce=()=>{me.value.copy()},ve=e=>{re.value=!0,e?(te.value="edit",se.value=JSON.parse(JSON.stringify(e)),ue.value=e):(te.value="add",ue.value=JSON.parse(JSON.stringify(q)))},fe=j(),be=()=>{fe.refs.fieldDialogNode.fieldDialogFrom.validate((e=>{if(!e)return!1;ue.value.fieldName=t(ue.value.fieldName),"add"===te.value&&de.value.fields.push(ue.value),re.value=!1}))},ge=()=>{"edit"===te.value&&(ue.value=se.value),re.value=!1},ye=y(null),Ne=async e=>de.value.fields.length<=0?(F({type:"error",message:"请填写至少一个field"}),!1):de.value.fields.some((e=>e.fieldName===de.value.structName))?(F({type:"error",message:"存在与结构体同名的字段"}),!1):void ye.value.validate((async a=>{var d;if(!a)return!1;for(const e in de.value)"string"==typeof de.value[e]&&(de.value[e]=de.value[e].trim());if(de.value.structName=t(de.value.structName),de.value.tableName=de.value.tableName.replace(" ",""),de.value.tableName||(de.value.tableName=i(l(de.value.structName))),de.value.structName===de.value.abbreviation)return F({type:"error",message:"structName和struct简称不能相同"}),!1;if(de.value.humpPackageName=i(de.value.packageName),e){const e=await o(de.value);ee.value=e.data.autoCode,ne.value=!0}else{const e=await u(de.value);if("false"===(null==(d=e.headers)?void 0:d.success))return;if(de.value.autoMoveFile)return void F({type:"success",message:"自动化代码创建成功，自动移动成功"});F({type:"success",message:"自动化代码创建成功，正在下载"});const a=new Blob([e]),l="ginvueadmin.zip";if("download"in document.createElement("a")){const e=window.URL.createObjectURL(a),t=document.createElement("a");t.style.display="none",t.href=e,t.setAttribute("download",l),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e)}else window.navigator.msSaveBlob(a,l)}})),_e=y([]),ke=y([]),he=async()=>{const e=await s({dbName:ae.value.dbName});0===e.code&&(le.value=e.data.tables),ae.value.tableName=""},Ve=async()=>{const e=["id","created_at","updated_at","deleted_at"],a=await r(ae.value);if(0===a.code){const l=d(ae.value.tableName);de.value.structName=t(l),de.value.tableName=ae.value.tableName,de.value.packageName=l,de.value.abbreviation=l,de.value.description=l+"表",de.value.autoCreateApiToSql=!0,de.value.autoMoveFile=!0,de.value.fields=[],a.data.columns&&a.data.columns.forEach((a=>{if(!e.some((e=>e===a.columnName))){const e=d(a.columnName);de.value.fields.push({fieldName:t(e),fieldDesc:a.columnComment||e+"字段",fieldType:ie.value[a.dataType],dataType:a.dataType,fieldJson:e,dataTypeLong:a.dataTypeLong&&a.dataTypeLong.split(",")[0],columnName:a.columnName,comment:a.columnComment,require:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""})}}))}},we=y([]),xe=async()=>{const e=await n();0===e.code&&(we.value=e.data.pkgs)},Ce=()=>{J.push({name:"autoPkg"})},Te=()=>{(async()=>{const e=await m();0===e.code&&(ke.value=e.data.dbs,_e.value=e.data.dbList)})(),(async()=>{["string","int","bool","float64","time.Time"].forEach((async e=>{const a=await c(e);a&&a.forEach((a=>{ie.value[a.label]=e}))}))})(),xe();const e=B.params.id;e&&(async e=>{const a=await p({id:Number(e)});0===a.code&&(de.value=JSON.parse(a.data.meta))})(e)};return Te(),N((()=>B.params.id),(e=>{"autoCodeEdit"===B.name&&Te()})),(t,i)=>{const d=_("pointer"),o=_("el-icon"),u=_("el-option"),s=_("el-select"),r=_("el-form-item"),n=_("el-button"),m=_("el-form"),p=_("el-collapse-item"),c=_("el-collapse"),v=_("el-input"),f=_("refresh"),b=_("document-add"),g=_("QuestionFilled"),y=_("el-tooltip"),N=_("el-checkbox"),F=_("el-table-column"),q=_("el-popover"),B=_("el-table"),j=_("el-dialog");return k(),h("div",null,[V(L,{href:"https://www.bilibili.com/video/BV1kv4y1g7nT?p=3",title:"此功能为开发环境使用，不建议发布到生产，具体使用效果请看视频https://www.bilibili.com/video/BV1kv4y1g7nT?p=3"}),w("div",A,[V(c,{modelValue:Z,"onUpdate:modelValue":i[2]||(i[2]=e=>Z=e),style:{"margin-bottom":"12px"}},{default:x((()=>[V(p,{name:"1"},{title:x((()=>[w("div",O,[C(" 点这里从现有数据库创建代码 "),V(o,{class:"header-icon"},{default:x((()=>[V(d)])),_:1})])])),default:x((()=>[V(m,{ref:"getTableForm",style:{"margin-top":"24px"},inline:!0,model:ae.value,"label-width":"120px"},{default:x((()=>[V(r,{label:"数据库名",prop:"structName"},{default:x((()=>[V(s,{modelValue:ae.value.dbName,"onUpdate:modelValue":i[0]||(i[0]=e=>ae.value.dbName=e),filterable:"",placeholder:"请选择数据库",onChange:he},{default:x((()=>[(k(!0),h(T,null,U(ke.value,(e=>(k(),z(u,{key:e.database,label:e.database,value:e.database},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(r,{label:"表名",prop:"structName"},{default:x((()=>[V(s,{modelValue:ae.value.tableName,"onUpdate:modelValue":i[1]||(i[1]=e=>ae.value.tableName=e),disabled:!ae.value.dbName,filterable:"",placeholder:"请选择表"},{default:x((()=>[(k(!0),h(T,null,U(le.value,(e=>(k(),z(u,{key:e.tableName,label:e.tableName,value:e.tableName},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),V(r,null,{default:x((()=>[V(n,{size:"small",type:"primary",onClick:Ve},{default:x((()=>[C("使用此表创建")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])]),w("div",R,[V(m,{ref_key:"autoCodeForm",ref:ye,rules:oe.value,model:de.value,"label-width":"120px",inline:!0},{default:x((()=>[V(r,{label:"Struct名称",prop:"structName"},{default:x((()=>[V(v,{modelValue:de.value.structName,"onUpdate:modelValue":i[3]||(i[3]=e=>de.value.structName=e),placeholder:"首字母自动转换大写"},null,8,["modelValue"])])),_:1}),V(r,{label:"TableName",prop:"tableName"},{default:x((()=>[V(v,{modelValue:de.value.tableName,"onUpdate:modelValue":i[4]||(i[4]=e=>de.value.tableName=e),placeholder:"指定表名（非必填）"},null,8,["modelValue"])])),_:1}),V(r,{label:"Struct简称",prop:"abbreviation"},{default:x((()=>[V(v,{modelValue:de.value.abbreviation,"onUpdate:modelValue":i[5]||(i[5]=e=>de.value.abbreviation=e),placeholder:"简称会作为入参对象名和路由group"},null,8,["modelValue"])])),_:1}),V(r,{label:"Struct中文名称",prop:"description"},{default:x((()=>[V(v,{modelValue:de.value.description,"onUpdate:modelValue":i[6]||(i[6]=e=>de.value.description=e),placeholder:"中文描述作为自动api描述"},null,8,["modelValue"])])),_:1}),V(r,{label:"文件名称",prop:"packageName"},{default:x((()=>[V(v,{modelValue:de.value.packageName,"onUpdate:modelValue":i[7]||(i[7]=e=>de.value.packageName=e),placeholder:"生成文件的默认名称(建议为驼峰格式,首字母小写,如sysXxxXxxx)",onBlur:i[8]||(i[8]=e=>{var a,t;(a=de.value)[t="packageName"]=l(a[t])})},null,8,["modelValue"])])),_:1}),V(r,{label:"Package（包）",prop:"package"},{default:x((()=>[V(s,{modelValue:de.value.package,"onUpdate:modelValue":i[9]||(i[9]=e=>de.value.package=e),style:{width:"194px"}},{default:x((()=>[(k(!0),h(T,null,U(we.value,(e=>(k(),z(u,{key:e.ID,value:e.packageName,label:e.packageName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),V(o,{class:"auto-icon",onClick:xe},{default:x((()=>[V(f)])),_:1}),V(o,{class:"auto-icon",onClick:Ce},{default:x((()=>[V(b)])),_:1})])),_:1}),V(r,{label:"业务库",prop:"businessDB"},{label:x((()=>[V(y,{content:"注：需要提前到db-list自行配置多数据库，此项为空则会使用gva本库创建自动化代码(global.GVA_DB),填写后则会创建指定库的代码(global.MustGetGlobalDBByDBName(dbname))",placement:"bottom",effect:"light"},{default:x((()=>[w("div",null,[C(" 业务库 "),V(o,null,{default:x((()=>[V(g)])),_:1})])])),_:1})])),default:x((()=>[V(s,{modelValue:de.value.businessDB,"onUpdate:modelValue":i[10]||(i[10]=e=>de.value.businessDB=e),style:{width:"194px"},placeholder:"选择业务库"},{default:x((()=>[(k(!0),h(T,null,U(_e.value,(e=>(k(),z(u,{key:e.aliasName,value:e.aliasName,label:e.aliasName,disabled:e.disable},{default:x((()=>[w("div",null,[w("span",null,D(e.aliasName),1),w("span",E,D(e.dbName),1)])])),_:2},1032,["value","label","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(r,null,{label:x((()=>[V(y,{content:"注：会自动在结构体添加 created_by updated_by deleted_by，方便用户进行资源权限控制",placement:"bottom",effect:"light"},{default:x((()=>[w("div",null,[C(" 创建资源标识 "),V(o,null,{default:x((()=>[V(g)])),_:1})])])),_:1})])),default:x((()=>[V(N,{modelValue:de.value.autoCreateResource,"onUpdate:modelValue":i[11]||(i[11]=e=>de.value.autoCreateResource=e)},null,8,["modelValue"])])),_:1}),V(r,null,{label:x((()=>[V(y,{content:"注：把自动生成的API注册进数据库",placement:"bottom",effect:"light"},{default:x((()=>[M])),_:1})])),default:x((()=>[V(N,{modelValue:de.value.autoCreateApiToSql,"onUpdate:modelValue":i[12]||(i[12]=e=>de.value.autoCreateApiToSql=e)},null,8,["modelValue"])])),_:1}),V(r,null,{label:x((()=>[V(y,{content:"注：自动迁移生成的文件到yaml配置的对应位置",placement:"bottom",effect:"light"},{default:x((()=>[P])),_:1})])),default:x((()=>[V(N,{modelValue:de.value.autoMoveFile,"onUpdate:modelValue":i[13]||(i[13]=e=>de.value.autoMoveFile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])]),w("div",$,[w("div",I,[V(n,{size:"small",type:"primary",onClick:i[14]||(i[14]=e=>ve())},{default:x((()=>[C("新增Field")])),_:1})]),V(B,{data:de.value.fields},{default:x((()=>[V(F,{align:"left",type:"index",label:"序列",width:"60"}),V(F,{align:"left",prop:"fieldName",label:"Field名"}),V(F,{align:"left",prop:"fieldDesc",label:"中文名"}),V(F,{align:"left",prop:"require",label:"是否必填"},{default:x((({row:e})=>[C(D(e.require?"是":"否"),1)])),_:1}),V(F,{align:"left",prop:"fieldJson","min-width":"120px",label:"FieldJson"}),V(F,{align:"left",prop:"fieldType",label:"Field数据类型",width:"130"}),V(F,{align:"left",prop:"dataTypeLong",label:"数据库字段长度",width:"130"}),V(F,{align:"left",prop:"columnName",label:"数据库字段",width:"130"}),V(F,{align:"left",prop:"comment",label:"数据库字段描述",width:"130"}),V(F,{align:"left",prop:"fieldSearchType",label:"搜索条件",width:"130"}),V(F,{align:"left",prop:"dictType",label:"字典",width:"130"}),V(F,{align:"left",label:"操作",width:"300",fixed:"right"},{default:x((e=>[V(n,{size:"small",type:"primary",link:"",icon:"edit",onClick:a=>ve(e.row)},{default:x((()=>[C("编辑")])),_:2},1032,["onClick"]),V(n,{size:"small",type:"primary",link:"",disabled:0===e.$index,onClick:a=>(e=>{if(0===e)return;const a=de.value.fields[e-1];de.value.fields.splice(e-1,1),de.value.fields.splice(e,0,a)})(e.$index)},{default:x((()=>[C("上移")])),_:2},1032,["disabled","onClick"]),V(n,{size:"small",type:"primary",link:"",disabled:e.$index+1===de.value.fields.length,onClick:a=>(e=>{if(e===de.value.fields.length-1)return;const a=de.value.fields[e+1];de.value.fields.splice(e+1,1),de.value.fields.splice(e,0,a)})(e.$index)},{default:x((()=>[C("下移")])),_:2},1032,["disabled","onClick"]),V(q,{modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,placement:"top"},{reference:x((()=>[V(n,{size:"small",type:"primary",link:"",icon:"delete",onClick:a=>e.row.visible=!0},{default:x((()=>[C("删除")])),_:2},1032,["onClick"])])),default:x((()=>[X,w("div",G,[V(n,{size:"small",type:"primary",link:"",onClick:a=>e.row.visible=!1},{default:x((()=>[C("取消")])),_:2},1032,["onClick"]),V(n,{type:"primary",size:"small",onClick:a=>{return l=e.$index,void de.value.fields.splice(l,1);var l}},{default:x((()=>[C("确定")])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),w("div",Q,[V(n,{size:"small",type:"primary",onClick:i[15]||(i[15]=e=>Ne(!0))},{default:x((()=>[C("预览代码")])),_:1}),V(n,{size:"small",type:"primary",onClick:i[16]||(i[16]=e=>Ne(!1))},{default:x((()=>[C("生成代码")])),_:1})])]),V(j,{modelValue:re.value,"onUpdate:modelValue":i[17]||(i[17]=e=>re.value=e),width:"70%",title:"组件内容"},{footer:x((()=>[w("div",W,[V(n,{size:"small",onClick:ge},{default:x((()=>[C("取 消")])),_:1}),V(n,{size:"small",type:"primary",onClick:be},{default:x((()=>[C("确 定")])),_:1})])])),default:x((()=>[re.value?(k(),z(e,{key:0,ref:"fieldDialogNode","dialog-middle":ue.value},null,8,["dialog-middle"])):S("",!0)])),_:1},8,["modelValue"]),V(j,{modelValue:ne.value,"onUpdate:modelValue":i[19]||(i[19]=e=>ne.value=e)},{header:x((()=>[w("div",H,[K,V(n,{size:"small",type:"primary",onClick:pe},{default:x((()=>[C("全选")])),_:1}),V(n,{size:"small",type:"primary",onClick:ce},{default:x((()=>[C("复制")])),_:1})])])),footer:x((()=>[w("div",Y,[V(n,{size:"small",type:"primary",onClick:i[18]||(i[18]=e=>ne.value=!1)},{default:x((()=>[C("确 定")])),_:1})])])),default:x((()=>[ne.value?(k(),z(a,{key:0,ref_key:"previewNode",ref:me,"preview-code":ee.value},null,8,["preview-code"])):S("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-ed11d2a0"]]);export{ee as default};

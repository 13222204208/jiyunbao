/*! 
 Build based on gin-vue-admin 
 Time : 1673519692000 */
import{g as e,f as a,d as l,c as t,u as i}from"./miniClassify.a8b4f0b8.js";import{f as o}from"./format.9730cff4.js";import{r as s,j as u,b as n,o as r,c as d,d as c,e as p,w as v,h as f,t as g,z as m,H as y,i as h,A as b}from"./index.29e958a1.js";import"./date.34b11046.js";import"./dictionary.756c2897.js";import"./dictionary.90e3faa4.js";import"./sysDictionary.77e8fb14.js";const w={class:"gva-table-box"},_={class:"gva-btn-list"},k={class:"gva-pagination"},z={class:"dialog-footer"},C={name:"MiniClassify"},j=Object.assign(C,{setup(C){const j=s("/api"),x=u(),D=s(""),V=s({title:"",pid:"0",icon:"",level:1,status:"1"}),I=s(1),S=s(0),U=s(100),A=s([]),B=s({}),E=s("新增分类"),T=s(!1),$=s(!1),H=e=>{$.value=!0;const a="image/jpeg"===e.type,l="image/png"===e.type,t=e.size/1024/1024<.5;return a||l||(h.error("上传图片只能是 jpg或png 格式!"),$.value=!1),t||(h.error("未压缩未见上传图片大小不能超过 500KB，请使用压缩上传"),$.value=!1),(l||a)&&t},K=e=>{if($.value=!1,console.log("图片",e),0===e.code){var a=e.data.file.url;D.value="/api/"+a,console.log("图片地址",D.value),V.value.icon=a,h({type:"success",message:"上传成功"}),0===e.code&&F()}else h({type:"warning",message:e.msg})},M=()=>{h({type:"error",message:"上传失败"}),$.value=!1};s(null);const O=e=>{U.value=e,F()},q=e=>{I.value=e,F()},F=async()=>{const a=await e({page:I.value,pageSize:U.value,...B.value});0===a.code&&(A.value=L(a.data.list),S.value=a.data.total,I.value=a.data.page,U.value=a.data.pageSize)};F();const G=async()=>{};G(),s([]);const J=s(""),L=e=>{var a=[],l=[],t={};return e.forEach((function(e){0==e.pid?a.push(e):l.push(e),e.children=[],t[e.ID]=e})),l.forEach((function(e){(t[e.pid]||{children:[]}).children.push(e)})),a},N=s(!1),P=()=>{J.value="create",D.value="",N.value=!0},Q=()=>{N.value=!1,V.value={title:"",pid:"0"}},R=async()=>{let e;switch(J.value){case"create":default:e=await t(V.value);break;case"update":e=await i(V.value)}0===e.code&&(h({type:"success",message:"创建/更改成功"}),Q(),F())};return(e,t)=>{const i=n("el-button"),s=n("el-table-column"),u=n("el-image"),C=n("el-table"),B=n("el-pagination"),$=n("el-input"),L=n("el-form-item"),W=n("el-upload"),X=n("el-switch"),Y=n("el-form"),Z=n("el-dialog");return r(),d("div",null,[c("div",w,[c("div",_,[p(i,{size:"small",type:"primary",icon:"plus",onClick:P},{default:v((()=>[f("新增")])),_:1})]),p(C,{data:A.value,"row-key":"ID"},{default:v((()=>[p(s,{align:"left",label:"ID",width:"100",prop:""}),p(s,{align:"left",label:"分类等级",style:{color:"blue"},width:"100",prop:"level"},{default:v((e=>[p(i,{type:"primary",plain:""},{default:v((()=>[f(g(e.row.level)+" 级",1)])),_:2},1024)])),_:1}),p(s,{align:"left",label:"名称",prop:"title",width:"120"}),p(s,{align:"left",label:"图标",prop:"icon",width:"150"},{default:v((e=>[p(u,{style:{width:"60px",height:"60px"},src:j.value+"/"+e.row.icon,fit:"cover"},null,8,["src"])])),_:1}),p(s,{align:"left",label:"状态",width:"180"},{default:v((e=>[f(g("1"==e.row.status?"已显示":"已隐藏"),1)])),_:1}),p(s,{align:"left",label:"日期",width:"180"},{default:v((e=>[f(g(m(o)(e.row.CreatedAt)),1)])),_:1}),p(s,{align:"left",label:"按钮组"},{default:v((e=>[p(i,{type:"primary",link:"",icon:"plus",size:"small",onClick:a=>{return l=e.row,console.log("eeee",l),E.value="新增分类",V.value.pid=String(l.ID),V.value.level=l.level+1,console.log(V.value),T.value=!1,G(),void(N.value=!0);var l}},{default:v((()=>[f("添加子菜单")])),_:2},1032,["onClick"]),p(i,{type:"primary",link:"",icon:"edit",size:"small",onClick:l=>(async e=>{console.log("id",e),E.value="编辑分类";const l=await a({ID:e});J.value="update",0===l.code&&(V.value=l.data.reminiClassify,T.value=!0,D.value="/api/"+l.data.reminiClassify.icon,N.value=!0)})(e.row.ID)},{default:v((()=>[f("编辑")])),_:2},1032,["onClick"]),p(i,{type:"primary",link:"",icon:"delete",size:"small",onClick:a=>{return t=e.row.ID,void b.confirm("此操作将永久删除所有角色下该菜单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await l({ID:t})).code&&(h({type:"success",message:"删除成功!"}),1===A.value.length&&I.value>1&&I.value--,F())})).catch((()=>{h({type:"info",message:"已取消删除"})}));var t}},{default:v((()=>[f("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),c("div",k,[p(B,{layout:"total, sizes, prev, pager, next, jumper","current-page":I.value,"page-size":U.value,"page-sizes":[10,30,50,100],total:S.value,onCurrentChange:q,onSizeChange:O},null,8,["current-page","page-size","total"])])]),p(Z,{modelValue:N.value,"onUpdate:modelValue":t[2]||(t[2]=e=>N.value=e),"before-close":Q,title:E.value},{footer:v((()=>[c("div",z,[p(i,{size:"small",onClick:Q},{default:v((()=>[f("取 消")])),_:1}),p(i,{size:"small",type:"primary",onClick:R},{default:v((()=>[f("确 定")])),_:1})])])),default:v((()=>[p(Y,{model:V.value,"label-position":"right","label-width":"80px"},{default:v((()=>[p(L,{label:"名称:"},{default:v((()=>[p($,{modelValue:V.value.title,"onUpdate:modelValue":t[0]||(t[0]=e=>V.value.title=e),clearable:"",placeholder:"请输入"},null,8,["modelValue"])])),_:1}),p(L,{label:"图标:"},{default:v((()=>[c("div",{class:"user-headpic-update",style:y({"background-image":`url(${D.value})`,"background-repeat":"no-repeat","background-size":"cover",width:"200px",height:"200px"})},null,4),p(W,{action:`${j.value}/fileUploadAndDownload/upload`,"before-upload":H,headers:{"x-token":m(x).token},"on-error":M,"on-success":K,"show-file-list":!1,class:"upload-btn"},{default:v((()=>[p(i,{size:"small",type:"primary"},{default:v((()=>[f("上传图片")])),_:1})])),_:1},8,["action","headers"])])),_:1}),p(L,{label:"显示"},{default:v((()=>[p(X,{modelValue:V.value.status,"onUpdate:modelValue":t[1]||(t[1]=e=>V.value.status=e),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}});export{j as default};

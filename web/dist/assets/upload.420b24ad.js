/*! 
 Build based on gin-vue-admin 
 Time : 1673519692000 */
import{_ as a,U as e,g as t,d as l,e as n}from"./common.c8e60ca0.js";import{C as i}from"./index.80b6a8f5.js";import{f as o}from"./format.9730cff4.js";import{W as s}from"./warningBar.e39232e5.js";import{_ as r,r as u,b as c,X as d,S as p,o as m,c as g,d as f,e as v,w as h,h as w,t as y,z as b,A as _,i as C}from"./index.29e958a1.js";import"./date.34b11046.js";import"./dictionary.756c2897.js";import"./dictionary.90e3faa4.js";import"./sysDictionary.77e8fb14.js";const k=(a,e)=>{var t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){var a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0,t.width,t.height);var l=a.toDataURL("image/png"),n=document.createElement("a"),i=new MouseEvent("click");n.download=e||"photo",n.href=l,n.dispatchEvent(i)},t.src=a},x={class:"gva-table-box"},j={class:"gva-btn-list"},z=["onClick"],U={class:"gva-pagination"},S={name:"Upload"},O=r(Object.assign(S,{setup(r){const S=u("/api"),O=u(""),B=u(""),E=u(1),A=u(0),T=u(10),V=u({}),I=u([]),D=a=>{T.value=a,M()},L=a=>{E.value=a,M()},M=async()=>{const a=await t({page:E.value,pageSize:T.value,...V.value});0===a.code&&(I.value=a.data.list,A.value=a.data.total,E.value=a.data.page,T.value=a.data.pageSize)};M();return(t,r)=>{const u=c("el-input"),F=c("el-form-item"),P=c("el-button"),R=c("el-form"),W=c("el-table-column"),X=c("el-tag"),q=c("el-table"),G=c("el-pagination"),H=d("loading");return p((m(),g("div",null,[f("div",x,[v(s,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),f("div",j,[v(a,{imageCommon:B.value,"onUpdate:imageCommon":r[0]||(r[0]=a=>B.value=a),class:"upload-btn",onOnSuccess:M},null,8,["imageCommon"]),v(e,{imageUrl:O.value,"onUpdate:imageUrl":r[1]||(r[1]=a=>O.value=a),"file-size":512,"max-w-h":1080,class:"upload-btn",onOnSuccess:M},null,8,["imageUrl"]),v(R,{ref:"searchForm",inline:!0,model:V.value},{default:h((()=>[v(F,{label:""},{default:h((()=>[v(u,{modelValue:V.value.keyword,"onUpdate:modelValue":r[2]||(r[2]=a=>V.value.keyword=a),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),v(F,null,{default:h((()=>[v(P,{size:"small",type:"primary",icon:"search",onClick:M},{default:h((()=>[w("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),v(q,{data:I.value},{default:h((()=>[v(W,{align:"left",label:"预览",width:"100"},{default:h((a=>[v(i,{"pic-type":"file","pic-src":a.row.url},null,8,["pic-src"])])),_:1}),v(W,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:h((a=>[f("div",null,y(b(o)(a.row.UpdatedAt)),1)])),_:1}),v(W,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:h((a=>[f("div",{class:"name",onClick:e=>(async a=>{_.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:a.name}).then((async({value:e})=>{a.name=e,0===(await n(a)).code&&(C({type:"success",message:"编辑成功!"}),M())})).catch((()=>{C({type:"info",message:"取消修改"})}))})(a.row)},y(a.row.name),9,z)])),_:1}),v(W,{align:"left",label:"链接",prop:"url","min-width":"300"}),v(W,{align:"left",label:"标签",prop:"tag",width:"100"},{default:h((a=>[v(X,{type:"jpg"===a.row.tag?"primary":"success","disable-transitions":""},{default:h((()=>[w(y(a.row.tag),1)])),_:2},1032,["type"])])),_:1}),v(W,{align:"left",label:"操作",width:"160"},{default:h((a=>[v(P,{size:"small",icon:"download",type:"primary",link:"",onClick:e=>{var t;(t=a.row).url.indexOf("http://")>-1||t.url.indexOf("https://")>-1?k(t.url,t.name):k(S.value+"/"+t.url,t.name)}},{default:h((()=>[w("下载")])),_:2},1032,["onClick"]),v(P,{size:"small",icon:"delete",type:"primary",link:"",onClick:e=>(async a=>{_.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await l(a)).code&&(C({type:"success",message:"删除成功!"}),1===I.value.length&&E.value>1&&E.value--,M())})).catch((()=>{C({type:"info",message:"已取消删除"})}))})(a.row)},{default:h((()=>[w("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),f("div",U,[v(G,{"current-page":E.value,"page-size":T.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:A.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:L,onSizeChange:D},null,8,["current-page","page-size","total"])])])])),[[H,t.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-bf064db4"]]);export{O as default};

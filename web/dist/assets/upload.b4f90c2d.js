/*! 
 Build based on gin-vue-admin 
 Time : 1675935707000 */
import{_ as e,U as a,g as t,d as l,e as n}from"./common.a036a82d.js";import{C as i}from"./index.5a85cef6.js";import{f as o}from"./format.a5b70b7c.js";import{W as s}from"./warningBar.ee37cb1e.js";import{_ as r,r as u,b as c,X as d,S as p,o as m,c as g,d as f,e as v,w as h,h as w,t as y,z as b,A as _,i as C}from"./index.3b117381.js";import"./date.34b11046.js";import"./dictionary.c64483b9.js";import"./dictionary.2e4ec8e3.js";import"./sysDictionary.3083fcf3.js";const k=(e,a)=>{var t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height);var l=e.toDataURL("image/png"),n=document.createElement("a"),i=new MouseEvent("click");n.download=a||"photo",n.href=l,n.dispatchEvent(i)},t.src=e},x={class:"gva-table-box"},j={class:"gva-btn-list"},z=["onClick"],U={class:"gva-pagination"},S={name:"Upload"},O=r(Object.assign(S,{setup(r){const S=u("/api"),O=u(""),B=u(""),E=u(1),A=u(0),T=u(10),V=u({}),I=u([]),D=e=>{T.value=e,M()},L=e=>{E.value=e,M()},M=async()=>{const e=await t({page:E.value,pageSize:T.value,...V.value});0===e.code&&(I.value=e.data.list,A.value=e.data.total,E.value=e.data.page,T.value=e.data.pageSize)};M();return(t,r)=>{const u=c("el-input"),F=c("el-form-item"),P=c("el-button"),R=c("el-form"),W=c("el-table-column"),X=c("el-tag"),q=c("el-table"),G=c("el-pagination"),H=d("loading");return p((m(),g("div",null,[f("div",x,[v(s,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),f("div",j,[v(e,{imageCommon:B.value,"onUpdate:imageCommon":r[0]||(r[0]=e=>B.value=e),class:"upload-btn",onOnSuccess:M},null,8,["imageCommon"]),v(a,{imageUrl:O.value,"onUpdate:imageUrl":r[1]||(r[1]=e=>O.value=e),"file-size":512,"max-w-h":1080,class:"upload-btn",onOnSuccess:M},null,8,["imageUrl"]),v(R,{ref:"searchForm",inline:!0,model:V.value},{default:h((()=>[v(F,{label:""},{default:h((()=>[v(u,{modelValue:V.value.keyword,"onUpdate:modelValue":r[2]||(r[2]=e=>V.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),v(F,null,{default:h((()=>[v(P,{size:"small",type:"primary",icon:"search",onClick:M},{default:h((()=>[w("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),v(q,{data:I.value},{default:h((()=>[v(W,{align:"left",label:"预览",width:"100"},{default:h((e=>[v(i,{"pic-type":"file","pic-src":e.row.url},null,8,["pic-src"])])),_:1}),v(W,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:h((e=>[f("div",null,y(b(o)(e.row.UpdatedAt)),1)])),_:1}),v(W,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:h((e=>[f("div",{class:"name",onClick:a=>(async e=>{_.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await n(e)).code&&(C({type:"success",message:"编辑成功!"}),M())})).catch((()=>{C({type:"info",message:"取消修改"})}))})(e.row)},y(e.row.name),9,z)])),_:1}),v(W,{align:"left",label:"链接",prop:"url","min-width":"300"}),v(W,{align:"left",label:"标签",prop:"tag",width:"100"},{default:h((e=>[v(X,{type:"jpg"===e.row.tag?"primary":"success","disable-transitions":""},{default:h((()=>[w(y(e.row.tag),1)])),_:2},1032,["type"])])),_:1}),v(W,{align:"left",label:"操作",width:"160"},{default:h((e=>[v(P,{size:"small",icon:"download",type:"primary",link:"",onClick:a=>{var t;(t=e.row).url.indexOf("http://")>-1||t.url.indexOf("https://")>-1?k(t.url,t.name):k(S.value+"/"+t.url,t.name)}},{default:h((()=>[w("下载")])),_:2},1032,["onClick"]),v(P,{size:"small",icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{_.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await l(e)).code&&(C({type:"success",message:"删除成功!"}),1===I.value.length&&E.value>1&&E.value--,M())})).catch((()=>{C({type:"info",message:"已取消删除"})}))})(e.row)},{default:h((()=>[w("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),f("div",U,[v(G,{"current-page":E.value,"page-size":T.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:A.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:L,onSizeChange:D},null,8,["current-page","page-size","total"])])])])),[[H,t.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-bf064db4"]]);export{O as default};
